<!DOCTYPE html>
<html>
    <head>
        <title>Create a problem</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
        <script type="text/javascript" src="/js/jquery.min.js"></script>
        <script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>

        <script src="/ace-editor/ace.js"></script>
        <script src="/ace-editor/ext-language_tools.js"></script>
        <script src="/ace-editor/theme-xcode.js"></script>

        <script src="/MathJax-master/MathJax.js">
            MathJax.Hub.Config({
                extensions: ["tex2jax.js"],
                jax: ["input/TeX","output/HTML-CSS"],
                tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
            });
        </script>

        <script type="text/javascript">
            $(document).ready(function() {
                ace.require("ace/ext/language_tools");

                var editor = ace.edit("question");

                editor.session.setMode("ace/mode/latex");
                editor.setTheme("ace/theme/xcode");

                editor.setOptions({ fontSize: "14pt" });

                editor.setOptions({
                    enableBasicAutocompletion: true,
                    enableSnippets: true,
                    enableLiveAutocompletion: true
                });

                editor.session.on("change", function() {
                    $("#preview_id").html(editor.getValue());
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub, "preview_id"]);
                });

                $("#create_problem_id").on("click", function() {
                    var code = $.trim($("#code_id").val());
                    var name = $.trim($("#name_id").val());
                    var question = $.trim(editor.getValue());
                    var tags = $.trim($("#tags_id").val());

                    $.post("/api/problems", JSON.stringify({ "email": window.parent.getEmail(), "key": window.parent.getKey(), "name": name, "code": code, "question":question, "tags": tags }), function(data) {
                        if(data.msg === "success") {
                            location.href = "../dashboard/index.html";
                        } else {
                            alert("Could not create problem");
                        }
                    });
                });
            });
        </script>
    </head>
    <body class="container" style="padding: 25px;">
        <div class="panel panel-primary">
            <div class="panel-body">
                <label>Code</label>
                <input type="text" value="" placeholder="#_Code" id="code_id" class="form-control" />

                <br>

                <label>Name</label>
                <input type="text" value="" placeholder="#_Name" id="name_id" class="form-control" />

                <br>

                <label>Question</label>
                <pre id="question" style="width: 100%; height: 500px;"></pre>

                <br>

                <label>Preview</label>
                <div class="panel panel-default">
                    <div class="panel-body" id="preview_id"></div>
                </div>


                <label>Tags</label>
                <input type="text" value="" placeholder="#_Tags" id="tags_id" class="form-control" />

                <br>

                <button id="create_problem_id" class="btn btn-success">Create Problem</button>
            </div>
        </div>
    </body>
</html>
